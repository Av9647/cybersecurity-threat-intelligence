#!/usr/bin/env bash
set -euo pipefail

echo "[1] Pulling NVD delta (3 days buffer)"
docker compose exec cve_search \
  python3 /app/sbin/db_updater.py -s nvd -d 3

echo "[2] Pulling CVE-List V5 delta & rebuilding maps"
docker compose run --rm --no-deps cvelist_importer

echo "[3] Computing both‐map diffs → SQS"
python importer/diff_maps.py

echo "✔  All steps complete."
